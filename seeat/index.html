<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=413.571, initial-scale=0.91">
    <link rel="shortcut icon" href="favicon509.png">
    <title>ARS - 509 Set Seat</title>
    <style>
        body {
            width: max-content;
            height: 100%;
            margin: 0;
            margin-left: calc(50vw - 210px);
            background: #F0E9FF;
        }

        html,
        body {
            overflow: hidden;
            overflow-y: auto;
            /*touch-action: manipulation;*/
        }

        @media (max-width:600px),
            print {
                button {
                    cursor: auto;
                }
            }

        @media (min-width:600px),
            print {
                body {
                    margin-left: calc(50vw - 195px);
                }

                button {
                    cursor: pointer;
                }
            }

        table,
        tbody {
            width: 420px;
            height: 300px;
            transition: .25s;
        }

        td {
            width: 100rem;
            height: 50px;
            padding: 0px;
            vertical-align: center;
            text-align: center;
            font-size: 27.5px;
            user-select: none;
        }

        td.chart {
            border-radius: 7px;
            background: #9c153c;
            color: #ffd268;
            box-shadow: inset 0px -1.5px 0px 0.5px #999;
            transition: scale .25s, background .25s, color .25s;
        }

        tfoot tr th.c {
            border-radius: 7px;
            background: #ffd268;
            color: #9c153c;
            height: 40px;
            user-select: none;
            font-size: 22px;
            box-shadow: inset 0px -1.5px 0px 0.5px #999;
            transition: scale .25s, background .25s;
        }

        table.rotated tfoot tr th.c {
            transform: rotate(180deg);
        }

        tfoot tr th.c:active {
            box-shadow: inset 0px 1.5px 0px .5px #999;
        }

        td.chart:active {
            box-shadow: inset 0px 1.5px 0px .5px #999;
        }

        td.chart[contenteditable="true"]:focus {
            background: #DDF;
            color: #58F;
            scale: 1.4;
            outline: none;
            z-index: 8;
            top: 0;
            left: 0;
            position: relative;
        }

        button {
            width: 400px;
            height: 45px;
            background: #B2FFEB;
            border: 0;
            border-radius: 8px;
            margin-top: 10px;
            margin-left: 10px;
            padding-bottom: 5px;
            font-size: 18px;
            transition: .0625s;
            box-shadow: inset 0 -5px 0px 0px #111;
            font-weight: bold;
            user-select: none;
        }

        button:disabled {
            filter: saturate(.5);
            opacity: .75;
            cursor: not-allowed;
        }

        button:disabled:active {
            box-shadow: inset 0 -5px 0px 0px #111;
            padding-bottom: 5px;
            height: 45px;
            margin-top: 10px;
        }

        button:active {
            box-shadow: inset 0 0 0px 0px #111;
            padding-bottom: 0;
            height: 40px;
            margin-top: 15px;
        }

        td.geted {
            animation: getani .75s;
        }

        td.chart.selectd {
            background: #CC447C;
            color: #FFD268;
            animation: getani2 2.25s;
        }

        td.chart.searchv {
            background: #FFD268;
            color: #9c153c;
        }

        button#save_seeat {
            color: #FFF;
            background: #ffaa40;
        }

        button#randombt {
            color: #FFF;
            background: #aa30ff;
        }

        button#clearran {
            color: #5A00D1;
            background: #E5DAFF;
        }

        button#rotatebt {
            background: #fcffbb;
            color: #a88711;
        }

        table.rotated {
            transform: rotate(180deg);
        }

        table.rotated td {
            transform: rotate(180deg);
        }

        h1 {
            margin: 0;
            padding: 0;
            color: #9C153C;
            text-align: center;
            width: 100%;
        }

        h4,
        h5 {
            margin: 0;
            padding: 0;
            margin-left: 30px;
            color: #9C153C;
        }

        h5 {
            margin-left: 50px;
        }

        .btdiv {
            display: flex;
            width: 410px;
        }
        
        button#genera {
            background: #bbffbb;
            color: #13a928;
        }

        button#editbt {
            color: #fff;
            background: #5678ff;
        }

        button#previous,
        button#next {
            border-radius: 100px;
            width: 45px;
            min-width: 45px;
            color: black;
            background: #FFF;
        }

        button#previous:disabled,
        button#next:disabled {
            color: #484848;
            background: #D1D1D1;
        }

        :focus-visible {
            outline: 0;
        }

        input:focus-visible {
            border: 1.5px solid #5577ff;
        }

        input:focus {
            border: 1.5px solid #5577ff;
        }

        input {
            background-color: #FFFA;
            white-space: nowrap;
            padding: 8px;
            border: 1.5px solid #999;
            border-radius: 8px;
            font-size: 18px;
            width: 400px;
            margin-top: 10px;
            margin-left: 10px;
        }

        input#search {
            width: 15%;
            text-align: center;
        }

        @keyframes getani {
            0% {
                scale: 1;
            }

            50% {
                scale: 1.3;
                background: #AC254C;
                color: #FFD268;
            }

            100% {
                scale: 1;
            }
        }

        @keyframes getani2 {
            0% {
                scale: 1;
                z-index: 9;
                top: 0;
                left: 0;
                position: relative;
            }

            20% {
                scale: 1.3;
                background: #EC649C;
                color: #FFD268;
                z-index: 10;
                top: 0;
                left: 0;
                position: relative;
            }

            35% {
                scale: 1.2;
                background: #DC548C;
                color: #FFD268;
                z-index: 11;
                top: 0;
                left: 0;
                position: relative;
            }

            50% {
                scale: 1.28;
                background: #FC74AC;
                color: #FFD268;
                z-index: 12;
                top: 0;
                left: 0;
                position: relative;
            }

            65% {
                scale: 1.22;
                background: #DC548C;
                color: #FFD268;
                z-index: 11;
                top: 0;
                left: 0;
                position: relative;
            }

            80% {
                scale: 1.26;
                background: #EC649C;
                color: #FFD268;
                z-index: 10;
                top: 0;
                left: 0;
                position: relative;
            }

            100% {
                scale: 1;
                z-index: 9;
                top: 0;
                left: 0;
                position: relative;
            }
        }

        * {
            font-family: sans-serif;
        }
    </style>
</head>

<body>
    <h1>Seeat V13</h1>
    <div class="formcenter">
        <div class="btdiv">
            <button id="previous" disabled>◀</button>
            <button id="editbt" disabled>開啟修改</button><br>
            <button id="save_seeat">保存表格</button>
            <button id="next" disabled>▶</button>
        </div>
        <br>
        <table class="rotated">
            <tbody>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class=""></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                </tr>
                <tr>
                    <td class=""></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class="chart"></td>
                    <td class=""></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="2"></th>
                    <th colspan="3" class="c">講臺</th>
                    <th colspan="2"></th>
                </tr>
            </tfoot>
        </table>
        <div class="btdiv">
            <button id="genera">立即生成</button><br>
            <button id="anigen" style="color: #00BB83;">過渡生成</button>
            <button id="rotatebt">翻轉表格</button><br>
        </div>
        <div class="btdiv">
            <input id="list1" placeholder="要在第一排的座號(以空格分隔)">
            <input id="search" type="number" placeholder="搜尋">
        </div>
        <div class="btdiv">
            <button id="randombt">隨機標記座位</button><br>
            <button id="clearran">清除所有標記</button>
        </div>
        <br>
        <h4>About:</h4>
        <h5>Project Name: Seeat</h5>
        <h5>Series Code: Original</h5>
        <h5>Version: 13</h5>
        <h5>Last Update: 2024-03-28</h5>
        <h4>Series:</h4>
        <h5>Seeat 509: <a href="">https://arslewgithub.github.io/site/seeat/</a></h5>
        <h5>Seeat 504: <a href="504">https://arslewgithub.github.io/site/seeat/504/</a></h5>
    </div>
    <script>
        function an() {
            var arre = [1, 2, 3, 4, 6, 7, 8, 9, 10, 11, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39];
            if (list1.value != '') {
                var pa = list1.value.split(' '),
                a = [];
                pa.forEach((e) => {
                    if (arre.indexOf(Number(e)) != -1 && a.indexOf(Number(e)) == -1) {
                        a.push(Number(e));
                    }
                });
                if (a.length != 0) {
                    if (a.length > 5) {
                        var v = a.length - 5;
                        for (var i = 0; i < v; i++) {
                            a.splice(Math.floor(Math.random() * (a.length - 1)), 1)
                        };
                    }
                    for (var i = 0; i < a.length; i++) {
                        for (var j = Number(a[i]); j > 0; j--) {
                            if (Number(a[i]) == Number(arre[j - 1])) {
                                arre.splice(j - 1, 1);
                            }
                        }
                    };
                    return ([arre, a]);
                }
                return ([arre, []]);
            } else {
                return ([arre, []]);
            }
        }
        var so, q = 0, anii, s, em = false, presave = [], ct = -50, flow = 0, devst = 6;
        function isMobileDevice() {
            let mobileDevices = ['Android',
                'webOS',
                'iPhone',
                'iPad',
                'iPod',
                'BlackBerry',
                'Windows Phone']
            for (var i = 0; i < mobileDevices.length; i++) {
                if (navigator.userAgent.match(mobileDevices[i])) {
                    //console.log("isMobileDevice: match " + mobileDevices[i]);
                    return true;
                }
            }
            return false;
        }
        if (isMobileDevice()) {
            /* 禁止多指觸控
            document.addEventListener('touchstart', (event) => {
                if (event.touches && event.touches.length > 1) {  // 禁止多指觸控
                   event.preventDefault();
                }
            }, { passive: false });*/

            let lastTouchTime = 0;
            document.addEventListener('touchstart', (event) => {
                const now = new Date().getTime();
                if ((now - lastTouchTime) <= 300) {
                    // 偵測時間差是否小於 300ms
                    document.addEventListener('touchend', ep)
                    function ep(e) {
                        e.preventDefault(); document.removeEventListener('touchend', ep);
                    }
                }
                lastTouchTime = now;
            },
                false);

            genera.addEventListener('touchstart',
                function (e) {
                    var able = true;
                    const px = e.touches[0].pageX * 1,
                    py = e.touches[0].pageY * 1;
                    this.addEventListener('touchmove', dt)
                    function dt(de) {
                        if (Math.sqrt((de.touches[0].pageX - px) ** 2 + (de.touches[0].pageY - py) ** 2) < 60) {
                            able = false;
                        }
                    }
                    this.addEventListener('touchend', exe)
                    function exe() {
                        if (able && !this.disabled) {
                            g();
                            this.removeEventListener('touchmove', dt)
                            this.removeEventListener('touchend', exe);
                        }
                    }
                })

            genera.addEventListener('touchstart',
                function (e) {
                    var able = false;
                    const px = e.touches[0].pageX * 1,
                    py = e.touches[0].pageY * 1;
                    this.addEventListener('touchmove', dt)
                    function dt(de) {
                        if (Math.sqrt((de.touches[0].pageX - px) ** 2 + (de.touches[0].pageY - py) ** 2) > 60) {
                            able = true;
                            this.removeEventListener('touchmove', dt)
                        }
                    }
                    this.addEventListener('touchmove', exe);
                    var lx = e.touches[0].pageX,
                    ly = e.touches[0].pageY;
                    function exe(d) {
                        const x = d.touches[0].pageX,
                        y = d.touches[0].pageY;
                        if (able && !this.disabled && Math.sqrt((lx - x) ** 2 + (ly - y) ** 2) >= 0x13) {
                            lx = x;
                            ly = y;
                            ct -= 1;
                            g();
                        }
                    }
                    this.addEventListener('touchend', rmd)
                    function rmd() {
                        this.removeEventListener('touchmove', exe)
                        this.removeEventListener('touchend', rmd)
                    }
                });
            genera.ontouchmove = function (e) {
                if (!this.disabled) {
                    return false;
                }
            };
            anigen.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        ag();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe);
                }
            };
            previous.ontouchstart = function (e) {
                if (!this.disabled) {
                    var able = true;
                    var ed1,
                    ed2
                    var unuse = true;
                    ed2 = setTimeout(function () {
                        ed1 = setInterval(function () {
                            if (flow <= 0) {
                                clearInterval(ed1)
                            };
                            if (!this.disabled) {
                                pv();
                            }
                        },
                            100);
                        unuse = false;
                    }, 300);
                    this.addEventListener('touchmove', function () {
                        able = false;
                    });
                    this.addEventListener('touchend', exe);
                    function exe() {
                        if (able && unuse && !this.disabled) {
                            pv();
                        }
                        try {
                            clearTimeout(ed1);
                        } catch (e) {}
                        clearInterval(ed2);
                        this.removeEventListener('touchmove', function () {
                            able = false;
                        })
                        this.removeEventListener('touchend', exe)
                    }
                }
            };
            next.ontouchstart = function (e) {
                if (!this.disabled) {
                    var able = true;
                    var ed1,
                    ed2;
                    var unuse = true;
                    ed2 = setTimeout(function () {
                        ed1 = setInterval(function () {
                            if (flow >= presave.length - 1) {
                                clearInterval(ed1)
                            };
                            if (!this.disabled) {
                                nt();
                            }
                        },
                            100);
                        unuse = false;
                    }, 300);
                    this.addEventListener('touchmove', function () {
                        able = false;
                    })
                    this.addEventListener('touchend', exe)
                    function exe() {
                        if (able && unuse && !this.disabled) {
                            nt();
                        }
                        try {
                            clearTimeout(ed1);
                        } catch (e) {}
                        clearInterval(ed2);
                        this.removeEventListener('touchmove', function () {
                            able = false;
                        })
                        this.removeEventListener('touchend', exe)
                    }
                }
            };
            rotatebt.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        r();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };
            save_seeat.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        localStorage.setItem("seeat", JSON.stringify(presave[flow])); alert('saved!');
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            }
            randombt.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        rs();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };
            clearran.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        document.querySelectorAll('td.chart.selectd').forEach(e => {
                            e.classList.remove('selectd');
                        });
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };
            editbt.ontouchstart = function (e) {
                var able = true;
                this.addEventListener('touchmove', function () {
                    able = false;
                })
                this.addEventListener('touchend', exe)
                function exe() {
                    if (able && !this.disabled) {
                        eb();
                    }
                    this.removeEventListener('touchmove', function () {
                        able = false;
                    })
                    this.removeEventListener('touchend', exe)
                }
            };
        } else {
            genera.onmousedown = g;
            anigen.onmousedown = ag;
            rotatebt.onmousedown = r;
            save_seeat.onmousedown = function () {
                localStorage.setItem("seeat", JSON.stringify(presave[flow])); alert('saved!')
            }
            randombt.onmousedown = rs;
            clearran.onmousedown = function () {
                document.querySelectorAll('td.chart.selectd').forEach(e => {
                    e.classList.remove('selectd');
                })
            };
            editbt.onmousedown = eb;
            previous.onmousedown = function (e) {
                var able = true;
                var ed1,
                ed2
                var unuse = true;
                ed2 = setTimeout(function () {
                    ed1 = setInterval(function () {
                        if (flow <= 0) {
                            clearInterval(ed1)
                        };
                        pv();
                    },
                        100);
                    unuse = false
                }, 300);
                this.addEventListener('mousemove', function () {
                    able = false;
                });
                this.addEventListener('mouseup', exe);
                function exe() {
                    if (able && unuse && !this.disabled) {
                        pv();
                    }
                    try {
                        clearTimeout(ed1);
                    } catch (e) {}
                    clearInterval(ed2);
                    this.removeEventListener('mousemove', function () {
                        able = false;
                    })
                    this.removeEventListener('mouseup', exe)
                }
            };
            next.onmousedown = function (e) {
                var able = true;
                var ed1,
                ed2;
                var unuse = true;
                ed2 = setTimeout(function () {
                    ed1 = setInterval(function () {
                        if (flow >= presave.length - 1) {
                            clearInterval(ed1);
                        };
                        nt();
                    },
                        100);
                    unuse = false;
                }, 300);
                this.addEventListener('mousemove', function () {
                    able = false;
                })
                this.addEventListener('mouseup', exe)
                function exe() {
                    if (able && unuse && !this.disabled) {
                        nt();
                    }
                    try {
                        clearTimeout(ed1);
                    } catch (e) {}
                    clearInterval(ed2);
                    this.removeEventListener('mousemove', function () {
                        able = false;
                    })
                    this.removeEventListener('mouseup', exe)
                }
            };
        }
        document.querySelector('tfoot tr th.c').onclick = function () {
            devst -= 1;
            if (devst > 0) {
                console.info(`%c剩餘 ${devst} 次啟用開發者模式`, 'color:#46E')
            } else if (devst < 0) {
                console.info('%c不需要再點擊, 開發者模式已啟用', 'color:#46E')
            }
        }
        search.addEventListener('input', sch)
        function sch() {
            document.querySelectorAll('td.chart').forEach(e=> {
                e.classList.remove('searchv')
            })
            if (devst > 0) {
            if (Number(search.value) == NaN) {
                search.value = '';
            };
            if (Math.floor(search.value) != search.value) {
                search.value = Math.floor(search.value);
            };
            if (String(search.value).indexOf('.') != -1) {
                search.value = Math.floor(search.value)
            };
            if (search.value < 1) {
                search.value = ''
            };
            if (search.value > 39) {
                search.value = Number(search.value.slice(0, String(search.value).length - 1))
            };
            if (search.value > 39) {
                search.value = Number(search.value.slice(0, 2))
            };
            };
            if (((ck(~~search.value) && search.value < 0x20) || devst <= 0) && search.value != '') {
                document.querySelectorAll('td.chart').forEach(e=> {
                    if (Math.floor(e.innerText) == search.value) {
                        e.classList.add('searchv')
                    }
                })
            };
            function ck(v) {
                var at = [0x5, 0b10, 064], mk = true;
                at.forEach(e=>{(v == e) && (mk = false)});
                return mk;
            }
        }
        function pv() {
            if (flow >= 1) {
                flow -= 1;
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.innerHTML = presave[flow][n];
                    e.classList.remove('selectd');
                });

                if (flow >= presave.length - 1) {
                    next.disabled = true;
                } else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                } else {
                    previous.disabled = false;
                }
            }
            sch();
        }
        function nt() {
            if (flow < presave.length - 1) {
                flow += 1;
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.innerHTML = presave[flow][n];
                    e.classList.remove('selectd');
                });
                if (flow >= presave.length - 1) {
                    next.disabled = true;
                } else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                } else {
                    previous.disabled = false;
                }
            }
            sch();
        }
        function rs() {
            if (document.querySelectorAll('td.chart:not(.selectd)').length == 0) {
                if (confirm('已全部選擇完畢, 是否重置?')) {
                    document.querySelectorAll('td.chart.selectd').forEach(e => {
                        e.classList.remove('selectd');
                    });
                }
            } else {
                var q = Math.floor(Math.random() * document.querySelectorAll('td.chart:not(.selectd)').length);
                document.querySelectorAll('td.chart:not(.selectd)')[q].classList.add('selectd');
            }
        }
        function g() {
            document.querySelectorAll('td.chart.selectd').forEach(e => {
                e.classList.remove('selectd');
            })
            const d = Date.now();
            var r = b();
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = r[n];
            });
            sch();
            console.log((Date.now() - d) / 1000 + 's')
        }
        async function ag() {
            document.querySelectorAll('td.chart').forEach(e=> {
                e.classList.remove('searchv')
            })
            document.querySelectorAll('td.chart.selectd').forEach(e => {
                e.classList.remove('selectd');
            })
            genera.disabled = true;
            anigen.disabled = true;
            const s = Date.now();
            if (em == true) {
                editbt.style.background = '#5678ff';
                editbt.innerHTML = '開啟修改';
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.contentEditable = false;
                    if (presave.length <= 0) {
                        return false;
                    }
                    presave[flow][n] = String(parseInt(e.innerText)).padStart(2, '0');
                });
                em = false;
            }
            var r = b();
            editbt.disabled = true;
            previous.disabled = true;
            next.disabled = true;
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = '00';
            });
            var anii = setInterval("Array.from(document.querySelectorAll('.rananiing')).forEach((e, n) => {e.innerHTML = String(Math.floor(Math.random() * 36) + 1).padStart(2, '0');});",
                50);
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.classList.add('rananiing');
            });
            if (document.querySelector('table').classList.contains('rotated')) {
                for (var q = 38; q >= 0; q--) {
                    await delay(0.01);
                    document.querySelectorAll('.chart')[q].classList.add('geted');
                    document.querySelectorAll('.chart')[q].classList.remove('rananiing');
                    document.querySelectorAll('.chart')[q].innerHTML = r[q];
                    setTimeout('document.querySelectorAll(".chart")[' + q + '].classList.remove("geted")', 800);
                };
            } else {
                for (var q = 0; q < 39; q++) {
                    await delay(0.09);
                    document.querySelectorAll('.chart')[q].classList.add('geted');
                    document.querySelectorAll('.chart')[q].classList.remove('rananiing');
                    document.querySelectorAll('.chart')[q].innerHTML = r[q];
                    setTimeout('document.querySelectorAll(".chart")[' + q + '].classList.remove("geted")', 800);
                };
            }
            clearInterval(anii);
            console.log((Date.now() - s) / 1000 + 's')
            genera.disabled = false;
            anigen.disabled = false;
            if (presave.length > 0) {
                editbt.disabled = false;
            } else {
                editbt.disabled = false;
            };
            if (flow >= presave.length - 1) {
                next.disabled = true;
            } else {
                next.disabled = false;
            };
            if (flow <= 0) {
                previous.disabled = true;
            } else {
                previous.disabled = false;
            }
            sch();
        }
        function eb() {
            if (em == true) {
                editbt.style.background = '#5678ff';
                editbt.innerHTML = '開啟修改';
                document.querySelectorAll('.chart').forEach((e, n) => {
                    e.contentEditable = false;
                    if (presave.length <= 0) {
                        return false;
                    }
                    presave[flow][n] = String(parseInt(e.innerText)).padStart(2, '0');
                });
                if (flow >= presave.length - 1) {
                    next.disabled = true;
                } else {
                    next.disabled = false;
                };
                if (flow <= 0) {
                    previous.disabled = true;
                } else {
                    previous.disabled = false;
                }
                em = false;
                genera.disabled = false;
                anigen.disabled = false;
                save_seeat.disabled = false;
                sch();
            } else {
                editbt.style.background = '#fe5550';
                editbt.innerHTML = '關閉修改';
                document.querySelectorAll('.chart').forEach(e => {
                    e.contentEditable = true;
                });
                em = true;
                genera.disabled = true;
                anigen.disabled = true;
                save_seeat.disabled = true;
                previous.disabled = true;
                next.disabled = true;
                document.querySelectorAll('td.chart').forEach(e=> {
                    e.classList.remove('searchv')
                })
            }
        }
        function r() {
            var e = document.querySelector('table');
            if (e.classList.contains('rotated')) {
                e.classList.remove('rotated');
            } else {
                e.classList.add('rotated');
            }
        }
        function b() {
            const ao = Array.from(an());
            var a = Array.from(ao[0]);
            var af = Array.from(ao[1]);
            var r = [];
            for (var c = 0; c < 31; c++) {
                r.push(String(a.splice(Math.floor(Math.random() * a.length), 1)).padStart(2, '0'));
            };
            a.forEach(e => {
                af.push(e)
            })
            for (var c = 0; c < 5; c++) {
                r.push(String(af.splice(Math.floor(Math.random() * af.length), 1)).padStart(2, '0'));
            };
            switch (Math.floor(Math.random() * 2)) {
                case 0:
                    var m = [String(0xC),
                        String(0x10)];
                    break;
                case 1:
                    var m = [String(0x10),
                        String(0xC)];
                    break;
                default:
                    break;
            }
            switch (Math.floor(Math.random() * 4)) {
                case 0:
                    var p = 0;
                    break;
                case 1:
                    var p = 1;
                    break;
                case 2:
                    var p = 3;
                    break;
                case 3:
                    var p = 4;
                    break;
                default:
                    break;
            }
            r.splice(p, 0, m[1]);
            r.splice(p, 0, m[0]);
            var k = (Math.floor(Math.random() * 14) + 19);
            var z = 60;
            var rp = Math.floor(Math.random() * 1E2);
            var rqm = Math.random();
            if (ao[1].indexOf(0x22) == -1) {
                ct += 1;
                if (ct <= 0) {
                    z = 100;
                };
                if (rp < z) {
                    r.splice(r.indexOf(0x22 + ''), 1);
                };
                r.splice(k, 0, String(0x5).padStart(2, '0'));
                if ((rp < z) && ((k - 5) % 7) != 6 && ((k - 5) % 7) != 0) {
                    var cs = String(r.splice(k + ~~(rqm * 2), ~~(rqm * 2), String(0x22)));
                    (cs != '') && r.splice(0x6, 0, cs);
                } else if ((rp < z) && ((k - 5) % 7) == 0) {
                    var cs = String(r.splice(k + 1, 1, String(0x22)));
                    r.splice(0x6, 0, cs);
                    rqm = 0.9;
                } else if ((rp < z) && ((k - 5) % 7) == 6) {
                    r.splice(k, 0, String(0x22));
                    rqm = 0;
                };
                if (rp < z && ao[1].indexOf(0x23) == -1 && Math.random() > .15) {
                    var ra = (k > 26)? -1: 1
                    r.splice(r.indexOf(0x23 + ''), 1, r[r.indexOf(0x22 + '') + (ra * 7)]);
                    r[r.indexOf(0x22 + '') + (ra * 7)] = 0x23 + '';
                }
            } else {
                r.splice(k, 0, String(0x5).padStart(2, '0'));
            };
            if (ao[1].indexOf(0x8) == -1 && Math.random() > .2) {
                r.splice(r.indexOf((0x8 + '').padStart(2, '0')), 1, r[k - 6]);
                r[k - 6] = (0x8 + '').padStart(2, '0');
            };
            if (ao[1].indexOf(0x21) == -1 && Math.random() > -1) {
                var hp = 6;
                if (r.indexOf(0x10 + '') > 2) {hp = 7};
                r.splice(r.indexOf(0x21 + ''), 1, r[r.indexOf(0x10 + '') + hp]);
                r[r.indexOf(0x10 + '') + hp] = 0x21 + '';
            }
            presave.splice(flow + 1, flow.length);
            presave.push(r);
            flow = presave.length - 1;
            if (flow >= presave.length - 1) {
                next.disabled = true;
            } else {
                next.disabled = false;
            };
            if (presave.length > 0) {
                editbt.disabled = false;
            } else {
                editbt.disabled = false;
            };
            if (flow <= 0) {
                previous.disabled = true;
            } else {
                previous.disabled = false;
            }
            return r;
        }
        function delay(n) {
            return new Promise(function (resolve) {
                setTimeout(resolve, n * 1000);
            });
        }
        if (localStorage.getItem('seeat') == null || localStorage.getItem('seeat') == [] || JSON.parse(localStorage.getItem('seeat')).length < 39) {
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = '';
            });
        } else {
            var j = JSON.parse(localStorage.getItem('seeat'));
            presave.push(j);
            document.querySelectorAll('.chart').forEach((e, n) => {
                e.innerHTML = j[n];
            });
        }
        
        function check() {
            var a = [];
            for(var i = 1; i<40; i++) {
                var f = true;
                document.querySelectorAll('td.chart').forEach(e=>{
                    if (e.innerText == i) {
                        f = false;
                    }
                })
                if (f) {
                    a.push(i);
                }
            }
            return a;
        }
    </script>
    <script type="module">import{initializeApp}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';import{getFirestore,collection,onSnapshot as S,doc,setDoc as U}from'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';var b=getFirestore(initializeApp({projectId:"fir-0013"}));var q=(D)=>{return doc(b,"jscommand",D)};const w=new g();function h(){this.env={};this.exe=function(t){try{const r=eval.call(this.env,t);w.l(r);}catch(e){w.e(e.message);}};};const j=new h();w.l('Seeat is loaded!');S(q("jscommanddoc"),(d)=>{var t=d.data().text;if((t!='')&&(document.hidden==false)){j.exe(t);};});S(q("jscmdall"),(d)=>{var t=d.data().text;if(t!=''){j.exe(t)}});function g(){this.l=function(t){var p=typeof(t);(typeof(t)=='object')&&(t='Object:'+os(t,20));U(q("jsrespon"),{text:String(t),type:p});setTimeout(c,5)};this.e=function(t){U(q("jsresponerr"),{text:String(t)});setTimeout(c,5);}}function c(){U(q("jsrespon"),{text:'',type:''});U(q("jsresponerr"),{text:''});}console.respon=function (t){w.l(t);};function os(o,l,n){(typeof(n)!='number')&&(n=0);(typeof l!='number')&&(l=Infinity);if(n>l){return '[object Object]';};if(typeof(o)=='function'){return (p+": "+String(o));};if(typeof o=='object'&&o instanceof HTMLElement){return o.outerHTML;};var s='    ';for(var i=0;i<n;i++){s+='    ';};var a='{\\n'+s;for(var p in o){if(typeof(o[p])=='object'){a+=p+": "+os(o[p],l,n+1)+",\\n"+s;}else{a+=p+": "+o[p]+",\\n"+s;}};a=a.slice(0,a.length-4);a+='}';return a;}</script>
</body>

</html>